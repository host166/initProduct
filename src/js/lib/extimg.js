// Exif.js 读取图像的元数据
eval(function(p,a,c,k,e,d){e=function(c){return(c<a?'':e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--){d[e(c)]=k[c]||e(c)}k=[function(e){return d[e]}];e=function(){return'\\w+'};c=1};while(c--){if(k[c]){p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c])}}return p}('!w(){w i(a){v!!a.1p}w j(a,b){K c,d,e,f,g;H(b=b||a.6A(/^1g\\:([^\\;]+)\\;2w,/6C)[1]||"",a=a.6F(/^1g\\:([^\\;]+)\\;2w,/6D,""),c=6x(a),d=c.1k,e=P 6w(d),f=P 6o(e),g=0;d>g;g++)f[g]=c.6s(g);v e}w k(a,b){K c=P 2s;c.2Z("2Y",a,!0),c.2T="2I",c.1w=w(){(2v==Z.1u||0===Z.1u)&&b(Z.2V)},c.35()}w l(b,c){w d(a){K d=m(a),e=o(a);b.1p=d||{},b.6u=e||{},c&&c.2n(b)}K e,f,g;b.1i?/^1g\\:/i.2M(b.1i)?(e=j(b.1i),d(e)):/^2I\\:/i.2M(b.1i)?(f=P 2a,f.1w=w(a){d(a.2c.2b)},k(b.1i,w(a){f.2H(a)})):(g=P 2s,g.1w=w(){E(2v!=Z.1u&&0!==Z.1u)6J"6P S 6O 6m";d(g.2V),g=2z},g.2Z("2Y",b.1i,!0),g.2T="5Q",g.35(2z)):1L.2a&&(b 1b 1L.5J||b 1b 1L.6f)&&(f=P 2a,f.1w=w(b){a&&L.M("1O 1N 1M 1k "+b.2c.2b.1q),d(b.2c.2b)},f.2H(b))}w m(b){K f,d,e,c=P 1Q(b);E(a&&L.M("1O 1N 1M 1k "+b.1q),1m!=c.F(0)||2E!=c.F(1))v a&&L.M("U a 1d 2N"),!1;H(d=2,e=b.1q;e>d;){E(1m!=c.F(d))v a&&L.M("U a 1d 2J 6d 2A "+d+", 6g: "+c.F(d)),!1;E(f=c.F(d+1),a&&L.M(f),6h==f)v a&&L.M("6k 6j 2J"),u(c,d+4,c.Q(d+2)-2);d+=2+c.Q(d+2)}}w o(b){K d,e,f,g,h,i,c=P 1Q(b);E(a&&L.M("1O 1N 1M 1k "+b.1q),1m!=c.F(0)||2E!=c.F(1))v a&&L.M("U a 1d 2N"),!1;H(d=2,e=b.1q,f=w(a,b){v 56===a.F(b)&&66===a.F(b+1)&&73===a.F(b+2)&&77===a.F(b+3)&&4===a.F(b+4)&&4===a.F(b+5)};e>d;){E(f(c,d))v g=c.F(d+7),0!==g%2&&(g+=1),0===g&&(g=4),h=d+8+g,i=c.Q(d+6+g),q(b,h,i);d++}}w q(a,b,c){H(K f,g,h,i,j,d=P 1Q(a),e={},k=b;b+c>k;)28===d.F(k)&&2===d.F(k+1)&&(i=d.F(k+2),i 1r p&&(h=d.82(k+3),j=h+5,g=p[i],f=t(d,k+5,h),e.2o(g)?e[g]1b 83?e[g].86(f):e[g]=[e[g],f]:e[g]=f)),k++;v e}w r(b,c,d,e,f){K i,j,k,g=b.Q(d,!f),h={};H(k=0;g>k;k++)i=d+12*k+2,j=e[b.Q(i,!f)],!j&&a&&L.M("1v 7Y: "+b.Q(i,!f)),h[j]=s(b,i,c,d,f);v h}w s(a,b,c,d,e){K i,j,k,l,m,n,f=a.Q(b+2,!e),g=a.T(b+4,!e),h=a.T(b+8,!e)+c;2m(f){x 1:x 7:E(1==g)v a.F(b+8,!e);H(i=g>4?h:b+8,j=[],l=0;g>l;l++)j[l]=a.F(i+l);v j;x 2:v i=g>4?h:b+8,t(a,i,g-1);x 3:E(1==g)v a.Q(b+8,!e);H(i=g>2?h:b+8,j=[],l=0;g>l;l++)j[l]=a.Q(i+2*l,!e);v j;x 4:E(1==g)v a.T(b+8,!e);H(j=[],l=0;g>l;l++)j[l]=a.T(h+4*l,!e);v j;x 5:E(1==g)v m=a.T(h,!e),n=a.T(h+4,!e),k=P 2l(m/n),k.2g=m,k.2f=n,k;H(j=[],l=0;g>l;l++)m=a.T(h+8*l,!e),n=a.T(h+4+8*l,!e),j[l]=P 2l(m/n),j[l].2g=m,j[l].2f=n;v j;x 9:E(1==g)v a.1h(b+8,!e);H(j=[],l=0;g>l;l++)j[l]=a.1h(h+4*l,!e);v j;x 10:E(1==g)v a.1h(h,!e)/a.1h(h+4,!e);H(j=[],l=0;g>l;l++)j[l]=a.1h(h+8*l,!e)/a.1h(h+4+8*l,!e);v j}}w t(a,b,c){K d="";H(n=b;b+c>n;n++)d+=2K.2G(a.F(n));v d}w u(b,c){K h,i,j,k,l,m,n;E("8d"!=t(b,c,4))v a&&L.M("U 1d 2k 1g! "+t(b,c,4)),!1;E(m=c+6,8g==b.Q(m))h=!1;47{E(4G!=b.Q(m))v a&&L.M("U 1d 2h 1g! (2Q 4F 4I 8k)"),!1;h=!0}E(42!=b.Q(m+2,!h))v a&&L.M("U 1d 2h 1g! (2Q 4K)"),!1;E(n=b.T(m+4,!h),8>n)v a&&L.M("U 1d 2h 1g! (4L 2A 4M 4J 8)",b.T(m+4,!h)),!1;E(i=r(b,m,m+n,e,h),i.1Z){k=r(b,m,m+i.1Z,d,h);H(j 1r k){2m(j){x"1R":x"z":x"1S":x"1P":x"1W":x"1F":x"1G":x"1J":x"2e":x"1H":x"1B":x"1C":x"1I":x"1K":x"2p":k[j]=g[j][k[j]];2F;x"2t":x"2q":k[j]=2K.2G(k[j][0],k[j][1],k[j][2],k[j][3]);2F;x"3a":k[j]=g.1l[k[j][0]]+g.1l[k[j][1]]+g.1l[k[j][2]]+g.1l[k[j][3]]}i[j]=k[j]}}E(i.1X){l=r(b,m,m+i.1X,f,h);H(j 1r l){2m(j){x"3b":l[j]=l[j][0]+"."+l[j][1]+"."+l[j][2]+"."+l[j][3]}i[j]=l[j]}}v i}K d,e,f,g,p,a=!1,b=Z,c=w(a){v a 1b c?a:Z 1b c?(Z.4H=a,2D 0):P c(a)};"2L"!=1s 1n?("2L"!=1s 2i&&2i.1n&&(1n=2i.1n=c),1n.2k=c):b.2k=c,d=c.4N={4O:"2t",4U:"2q",4V:"4W",4T:"4S",4P:"4Q",4R:"3a",4E:"4D",4q:"4r",4s:"4p",4o:"4l",4m:"4n",4t:"4u",4A:"4B",4C:"4z",4y:"4v",4w:"4x",4X:"4Y",4k:"1P",5r:"5s",5p:"5o",5l:"5m",5n:"5t",5u:"5A",5B:"5z",5y:"5v",5w:"5x",5k:"5j",54:"1S",57:"1R",58:"z",53:"52",4Z:"50",51:"59",5a:"5g",5h:"5i",5f:"5e",5b:"5c",5d:"5C",3W:"3j",3f:"1W",3D:"2p",3z:"1G",3A:"3B",3v:"1J",3p:"3o",3x:"2e",3t:"3q",3n:"3C",3w:"1F",3m:"1H",3h:"1B",3i:"1C",3k:"1I",3g:"3l",3e:"1K",2u:"2B",3r:"46"},e=c.48={45:"44",40:"41",49:"1Z",4i:"1X",2u:"2B",3L:"3M",3N:"3G",3H:"3I",3O:"3V",3X:"3U",3S:"4g",3R:"3Q",3T:"3P",3F:"3J",3K:"3Y",3Z:"4d",4c:"4b",4e:"4f",4h:"3E",4a:"43",4j:"3y",3u:"3s",5q:"67",7z:"7A",7B:"7y",7x:"7t",7u:"7v",7w:"7C",7D:"7K",7L:"7M",7J:"7I",7E:"7F",7G:"7H"},f=c.7s={0:"3b",1:"7r",2:"7d",3:"7e",4:"7f",5:"7c",6:"7b",7:"75",8:"76",9:"78",10:"7a",11:"7g",12:"7h",13:"7o",14:"7p",15:"7q",16:"7n",17:"7m",18:"7i",19:"7j",20:"7k",21:"7l",22:"7N",23:"7O",24:"8h",25:"8i",26:"8f",27:"8c",28:"8e",29:"5D",30:"8r"},g=c.8o={1P:{0:"U 2r",1:"2R",2:"1o 1T",3:"8l 2P",4:"8n 2P",5:"8m 1T",6:"8p 1T",7:"38 y",8:"3d y"},1S:{0:"1v",1:"8q",2:"8j",3:"8a",4:"7U",5:"8b",6:"7W",1m:"2O"},1R:{0:"1v",1:"2S",2:"7T",3:"7S (7P I)",4:"z",9:"7Q 34",10:"7R 34",11:"7X",12:"2S 1A (D 87 - 88)",13:"84 1y 1A (N 7Z - 81)",14:"7V 1y 1A (W 72 - 74)",15:"68 1A (6a 64 - 63)",17:"1t I A",18:"1t I B",19:"1t I C",20:"5Z",21:"60",22:"61",23:"62",24:"6b 6c 6i",1m:"2O"},z:{0:"z 1U S 1V",1:"z J",5:"2C v I S O",7:"2C v I O",9:"z J, 1f 1c y",13:"z J, 1f 1c y, v I S O",15:"z J, 1f 1c y, v I O",16:"z 1U S 1V, 1f 1c y",24:"z 1U S 1V, 1e y",25:"z J, 1e y",29:"z J, 1e y, v I S O",31:"z J, 1e y, v I O",32:"6e 1c w",65:"z J, 1a-V X y",69:"z J, 1a-V X y, v I S O",71:"z J, 1a-V X y, v I O",73:"z J, 1f 1c y, 1a-V X y",77:"z J, 1f 1c y, 1a-V X y, v I S O",79:"z J, 1f 1c y, 1a-V X y, v I O",89:"z J, 1e y, 1a-V X y",5Y:"z J, 1e y, v I S O, 1a-V X y",5X:"z J, 1e y, v I O, 1a-V X y"},1W:{1:"U 2r",2:"5K-1Y 2d 1x 1j",3:"5L-1Y 2d 1x 1j",4:"5M-1Y 2d 1x 1j",5:"2y 2x 1x 1j",7:"5I 1j",8:"2y 2x 5E 1j"},1F:{0:"1t",1:"3d",2:"38",3:"5F 5G"},1G:{1:"5H 5N"},1J:{0:"1o 2U",1:"5O 2U"},2e:{0:"5U 1y 33",1:"2R 1y 33"},1H:{0:"5V",1:"1D 1z 2X",2:"1E 1z 2X",3:"1D 1z 2W",4:"1E 1z 2W"},1B:{0:"1o",1:"36",2:"37"},1C:{0:"1o",1:"1D 3c",2:"1E 3c"},1I:{0:"1o",1:"36",2:"37"},1K:{0:"1v",1:"5W",2:"5T 39",3:"5S 39"},2p:{3:"5P"},1l:{0:"",1:"Y",2:"5R",3:"6l",4:"R",5:"G",6:"B"}},p={6Q:"6N",6M:"6I",25:"6K",55:"6L",80:"6R",85:"6S",6Y:"6Z",70:"6X",6W:"6T",15:"6U"},c.6V=w(a,b){v(a 1b 6H||a 1b 6G)&&!a.6t?!1:(i(a)?b&&b.2n(a):l(a,b),!0)},c.6v=w(a,b){v i(a)?a.1p[b]:2D 0},c.6r=w(a){E(!i(a))v{};K b,c=a.1p,d={};H(b 1r c)c.2o(b)&&(d[b]=c[b]);v d},c.6n=w(a){E(!i(a))v"";K b,c=a.1p,d="";H(b 1r c)c.2o(b)&&(d+="6p"==1s c[b]?c[b]1b 2l?b+" : "+c[b]+" ["+c[b].2g+"/"+c[b].2f+"]\\r\\n":b+" : ["+c[b].1k+" 6q]\\r\\n":b+" : "+c[b]+"\\r\\n");v d},c.6E=w(a){v m(a)},"w"==1s 2j&&2j.6B&&2j("6y-6z",[],w(){v c})}.2n(Z);',62,524,'|||||||||||||||||||||||||||||||return|function|case|mode|Flash|||||if|getUint8||for|light|fired|var|console|log||detected|new|getUint16||not|getUint32|Not|eye||reduction||this|||||||||||red|instanceof|flash|valid|auto|compulsory|data|getInt32|src|sensor|length|Components|255|exports|Normal|exifdata|byteLength|in|typeof|Standard|status|Unknown|onload|area|white|gain|fluorescent|Contrast|Saturation|Low|High|SceneCaptureType|SceneType|GainControl|Sharpness|CustomRendered|SubjectDistanceRange|window|of|file|Got|ExposureProgram|DataView|LightSource|MeteringMode|program|did|fire|SensingMethod|GPSInfoIFDPointer|chip|ExifIFDPointer|||||||||||FileReader|result|target|color|WhiteBalance|denominator|numerator|TIFF|module|define|EXIF|Number|switch|call|hasOwnProperty|FileSource|FlashpixVersion|defined|XMLHttpRequest|ExifVersion|40965|200|base64|sequential|Color|null|offset|InteroperabilityIFDPointer|Strobe|void|216|break|fromCharCode|readAsArrayBuffer|blob|marker|String|undefined|test|JPEG|Other|priority|no|Manual|Daylight|responseType|process|response|down|up|GET|open||||balance|weather|send|Soft|Hard|Portrait|view|ComponentsConfiguration|GPSVersionID|saturation|Landscape|41996|41495|41995|41992|41993|ExposureIndex|41994|DeviceSettingDescription|41991|41989|ExposureMode|41986|DigitalZoomRation|42016|TransferFunction|41988|301|41985|41990|41987|JPEGInterchangeFormatLength|41729|41730|CFAPattern|FocalLengthIn35mmFilm|41728|StripByteCounts|282|Compression|262|PhotometricInterpretation|XResolution|283|258|BitsPerSample|259|274|YCbCrPositioning|YCbCrSubSampling|530|284|531|SamplesPerPixel|Orientation|41493|277|YResolution|296|257|ImageHeight||JPEGInterchangeFormat|ImageWidth|256|ImageUniqueID|else|TiffTags|34665|513|StripOffsets|273|ResolutionUnit|278|RowsPerStrip|PlanarConfiguration|279|34853|514|34850|RelatedSoundFile|36867|DateTimeOriginal|40964|UserComment|37500|MakerNote|37510|36868|DateTimeDigitized|SubsecTimeDigitized|33434|ExposureTime|37522|SubsecTimeOriginal|37520|SubsecTime|37521|CompressedBitsPerPixel|37122|0x4949|19789|EXIFwrapped|or|than|0x002A|First|less|Tags|36864|40963|PixelYDimension|37121|PixelXDimension|40962|40960|40961|ColorSpace|33437|FNumber|37386|FocalLength|41483|SubjectArea|37396|37383|||37384|37385|FlashEnergy|41484|41488|FocalPlaneResolutionUnit|41492|FocalPlaneYResolution|41487|SpatialFrequencyResponse|41486|FocalPlaneXResolution|SubjectDistance|37382|34856|OECF|37377|ISOSpeedRatings|34855|318|34852|SpectralSensitivity|ShutterSpeedValue|37378|ExposureBias|37381|MaxApertureValue|37380|BrightnessValue|ApertureValue|37379|SubjectLocation|GPSDateStamp|linear|Night|scene|Directly|Trilinear|Blob|One|Two|Three|photographed|Custom|DSC|arraybuffer|Cb|Distant|Close|Auto|None|Macro|95|93|D55|D65|D75|D50|3700K|3200|||WhitePoint|White||WW|ISO|studio|at|No|File|found|225|tungsten|0xFFE1|Found|Cr|image|pretty|Uint8Array|object|values|getAllTags|charCodeAt|complete|iptcdata|getTag|ArrayBuffer|atob|exif|js|match|amd|im|gim|readFromBinaryFile|replace|HTMLImageElement|Image|credit|throw|keywords|dateCreated|110|caption|load|Could|120|byline|bylineTitle|copyright|category|getData|116|headline|122|captionWriter|105||3900||4500K|GPSTimeStamp|GPSSatellites||GPSStatus||GPSMeasureMode|GPSAltitude|GPSAltitudeRef|GPSLatitude|GPSLongitudeRef|GPSLongitude|GPSDOP|GPSSpeedRef|GPSMapDatum|GPSDestLatitudeRef|GPSDestLatitude|GPSDestLongitudeRef|GPSImgDirection|GPSImgDirectionRef|GPSSpeed|GPSTrackRef|GPSTrack|GPSLatitudeRef|GPSTags|ReferenceBlackWhite|306|DateTime|270|532|YCbCrCoefficients|319|PrimaryChromaticities|529|ImageDescription|271|315|Artist|33432|Copyright|Software|305|Make|272|Model|GPSDestLongitude|GPSDestBearingRef|incandescent|Fine|Cloudy|Tungsten|Fluorescent|MultiSpot|Cool|Partial|Shade|tag|4600||5400K|getInt16|Array|Day||push|5700|7100K||Spot|Pattern|GPSProcessingMethod|Exif|GPSAreaInformation|GPSDestDistance|18761|GPSDestBearing|GPSDestDistanceRef|CenterWeightedAverage|0x4D4D|Aperture|Creative|Shutter|StringValues|Action|Average|GPSDifferential'.split('|'),0,{}));


/**
 * 第一，该文件用到exifjs库，第二，ie9以下肯定没办法使用的，第三，该工具针对ios对大图片画到canvas时候变成细长的情况的bug也做了处理。
 *
 */
var ImageOrientationFix=function(a){function e(a){var e,f,g,h,i,j,k,c=(a.naturalWidth,a.naturalHeight),d=document.createElement("canvas");for(d.width=1,d.height=c,e=d.getContext("2d"),e.drawImage(a,0,0),f=e.getImageData(0,0,1,c).data,g=0,h=c,i=c;i>g;)j=f[4*(i-1)+3],0===j?h=i:g=i,i=h+g>>1;return k=i/c,0===k?1:k}function f(a,b,c,d,f,g,h,i,j,k){var l=e(b);a.drawImage(b,c*l,d*l,f*l,g*l,h,i,j,k)}var g,h,b={image:"",imgType:"url",onFix:function(){}},c={},d="";return $.extend(b,a),g={init:function(){var a=new Image,e=this;d=a,a.onload=function(){EXIF.getData(this,function(){c=EXIF.getAllTags(this),e.__fix()})},a.src="image"==b.imgType?$(b.image).attr("src"):b.image},__fix:function(){var e,g,h,i,j,k,l,m,n,a={width:d.naturalWidth,height:d.naturalHeight,transX:0,transY:0,XDimension:0,YDimension:0,Orientation:1};switch(a.Orientation=c.Orientation,void 0==a.Orientation&&(a.Orientation=1),e=0,g=0,1!=a.Orientation?(a.transX=parseInt(a.width/2),a.transY=parseInt(a.height/2)):(a.transX=0,a.transY=0),e=d.width,g=d.height,h=c["PixelXDimension"],i=c["PixelYDimension"],a.XDimension=h,a.YDimension=i,j=document.createElement("canvas"),j.width=a.width,j.height=a.height,k=j.getContext("2d"),k.clearRect(0,0,j.width,j.height),f(k,d,0,0,e,g,0,0,e,g),l=document.createElement("canvas"),m=l.getContext("2d"),a.Orientation){case 8:e=i,g=h,l.width=e,l.height=g,m.translate(parseInt(e/2),parseInt(g/2)),m.rotate(-.5*Math.PI),m.drawImage(j,0,0,j.width,j.height,0-a.transX,0-a.transY,j.width,j.height);break;case 3:e=h,g=i,l.width=e,l.height=g,m.translate(parseInt(e/2),parseInt(g/2)),m.rotate(Math.PI),m.drawImage(j,0,0,j.width,j.height,0-a.transX,0-a.transY,j.width,j.height);break;case 6:e=i,g=h,l.width=e,l.height=g,m.translate(parseInt(e/2),parseInt(g/2)),m.rotate(.5*Math.PI),m.drawImage(j,0,0,j.width,j.height,0-a.transX,0-a.transY,j.width,j.height);break;case 1:l.width=e,l.height=g,m.drawImage(j,0,0,e,g,0-a.transX,0-a.transY,j.width,j.height)}n=l.toDataURL("image/jpeg",1),b.onFix(n)}},g.init(),h={getExif:function(){return c}}};